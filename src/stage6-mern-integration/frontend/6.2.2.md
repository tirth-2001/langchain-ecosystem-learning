## âš™ï¸ **Stage 6.2.2 â€” API Client & Utility Layer**

---

### ðŸŽ¯ **Goal**

- Build a **reusable Axios client** with interceptors for request/response handling
- Manage **base URLs**, **auth headers**, and **error formatting** in one place
- Prepare utility functions for backend modules like:

  - `/ask` â†’ LangChain chat
  - `/tasks` â†’ Task CRUD

- Set up **Tailwind CSS** (once) for smoother UI progress in later stages

---

## ðŸ§  **Theory Overview**

#### Why an API Client Layer?

Instead of writing `fetch()` or `axios.get()` everywhere:

- âœ… Centralize API configuration (base URL, timeouts, headers)
- âœ… Handle errors consistently (e.g., token expiry, network errors)
- âœ… Allow type-safe responses (via TypeScript generics)
- âœ… Ready-to-use hooks later (`useApi`, `useStream`, etc.)

---

## ðŸ§± **Folder Structure (Incremental Update)**

```
client/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ client.ts              # Axios setup
â”‚   â”‚   â”œâ”€â”€ endpoints/
â”‚   â”‚   â”‚   â”œâ”€â”€ ask.api.ts         # /api/ask
â”‚   â”‚   â”‚   â””â”€â”€ tasks.api.ts       # /api/tasks
â”‚   â”‚   â””â”€â”€ types.ts               # common response types
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ errorHandler.ts        # uniform error formatting
â”‚   â”‚   â””â”€â”€ constants.ts
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â””â”€â”€ index.css              # Tailwind entrypoint
â”‚   â””â”€â”€ main.tsx
```

---

## ðŸ§© **Implementation**

### **1. Install Dependencies**

```bash
yarn add axios
yarn add -D tailwindcss postcss autoprefixer
npx tailwindcss init -p
```

---

### **2. Configure Tailwind**

#### `tailwind.config.js`

```js
/** @type {import('tailwindcss').Config} */
export default {
  content: ['./index.html', './src/**/*.{js,ts,jsx,tsx}'],
  theme: {
    extend: {},
  },
  plugins: [],
}
```

#### `src/styles/index.css`

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Optional global styles */
body {
  @apply bg-gray-50 text-gray-900;
}
```

And import this in `main.tsx`:

```ts
import './styles/index.css'
```

âœ… **Tailwind is now ready** â€” lightweight and integrated.

---

### **3. Create Axios Client â€“ `src/api/client.ts`**

```ts
import axios, { AxiosError } from 'axios'

const API_BASE_URL = import.meta.env.VITE_API_BASE_URL

// Create Axios instance
const apiClient = axios.create({
  baseURL: API_BASE_URL,
  timeout: 15000, // 15s default
  headers: {
    'Content-Type': 'application/json',
  },
})

// Optional: Token injection (ready for 6.2.4)
apiClient.interceptors.request.use((config) => {
  const token = localStorage.getItem('authToken')
  if (token) config.headers.Authorization = `Bearer ${token}`
  return config
})

// Global error handling
apiClient.interceptors.response.use(
  (response) => response,
  (error: AxiosError) => {
    const message =
      error.response?.data && typeof error.response.data === 'object'
        ? (error.response.data as any).message
        : error.message

    console.error('API Error:', message)
    return Promise.reject(new Error(message))
  },
)

export default apiClient
```

---

### **4. Create Common API Types â€“ `src/api/types.ts`**

```ts
export interface ApiResponse<T> {
  success: boolean
  data: T
  message?: string
}

export interface Task {
  id: string
  title: string
  description: string
  status: 'pending' | 'running' | 'completed' | 'failed'
  result?: string
  createdAt: string
}
```

---

### **5. Create API Modules (Encapsulated Endpoints)**

#### ðŸ“˜ `src/api/endpoints/ask.api.ts`

```ts
import apiClient from '../client'
import { ApiResponse } from '../types'

export const askLLM = async (prompt: string) => {
  const res = await apiClient.post<ApiResponse<{ reply: string }>>('/ask', { prompt })
  return res.data
}
```

#### ðŸ“— `src/api/endpoints/tasks.api.ts`

```ts
import apiClient from '../client'
import { ApiResponse, Task } from '../types'

export const getAllTasks = async () => {
  const res = await apiClient.get<ApiResponse<Task[]>>('/tasks')
  return res.data
}

export const createTask = async (task: Omit<Task, 'id' | 'createdAt' | 'status'>) => {
  const res = await apiClient.post<ApiResponse<Task>>('/tasks', task)
  return res.data
}
```

---

### **6. Create Utility â€“ `src/utils/errorHandler.ts`**

```ts
export const handleApiError = (error: unknown): string => {
  if (error instanceof Error) return error.message
  return 'Unknown API error occurred'
}
```

---

### **7. Update Example Component**

#### `src/components/HealthCheck.tsx`

(Modify to test `askLLM()` API)

```tsx
import { useState } from 'react'
import { askLLM } from '../api/endpoints/ask.api'
import { handleApiError } from '../utils/errorHandler'

export default function HealthCheck() {
  const [prompt, setPrompt] = useState('')
  const [response, setResponse] = useState('')
  const [loading, setLoading] = useState(false)

  const handleAsk = async () => {
    setLoading(true)
    setResponse('')
    try {
      const res = await askLLM(prompt)
      setResponse(res.data.reply)
    } catch (err) {
      setResponse(handleApiError(err))
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="max-w-lg mx-auto mt-8 p-4 bg-white rounded-2xl shadow">
      <h2 className="text-xl font-semibold text-center mb-4">ðŸ”— Backend Connectivity & Ask LLM Test</h2>
      <textarea
        value={prompt}
        onChange={(e) => setPrompt(e.target.value)}
        placeholder="Ask something..."
        className="w-full border border-gray-300 rounded-lg p-2 mb-3 focus:ring focus:ring-blue-200"
        rows={3}
      />
      <button
        onClick={handleAsk}
        disabled={loading || !prompt}
        className="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 rounded-lg transition disabled:opacity-60"
      >
        {loading ? 'Asking...' : 'Send to LLM'}
      </button>

      {response && (
        <div className="mt-4 p-3 border-t border-gray-200 bg-gray-50 rounded-lg">
          <strong>Response:</strong>
          <p className="mt-1 text-gray-800 whitespace-pre-wrap">{response}</p>
        </div>
      )}
    </div>
  )
}
```

---

## âœ… **Checkpoint Summary**

| Feature                            | Description                          | Status |
| ---------------------------------- | ------------------------------------ | ------ |
| Axios client with interceptors     | Base API connection + error handling | âœ…     |
| Type-safe API responses            | Using generics and interface         | âœ…     |
| Task & Ask API modules             | Modular endpoint structure           | âœ…     |
| Tailwind setup                     | Ready for all future UI stages       | âœ…     |
| Frontend test with `/ask` endpoint | Functional                           | âœ…     |
